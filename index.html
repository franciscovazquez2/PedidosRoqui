<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos App</title>
</head>
<body>
  <h1>Crear Pedido</h1>

  <form id="pedidoForm">
    <label>Proveedor: <input type="text" id="proveedor" required></label><br><br>
    <label>Producto: <input type="text" id="producto" required></label><br><br>
    <label>Cantidad: <input type="number" id="cantidad" required></label><br><br>
    <button type="submit">Agregar</button>
  </form>

  <p id="mensaje"></p>

  <h2>Pedidos cargados</h2>
    <table border="1" id="tablaPedidos">
    <thead>
        <tr>
        <th>Proveedor</th>
        <th>Producto</th>
        <th>Cantidad</th>
        </tr>
    </thead>
    <tbody>

    </tbody>
    </table>

  <script>

    document.getElementById("pedidoForm").addEventListener("submit", async e => {
      e.preventDefault();
      const pedido = {
        proveedor: document.getElementById("proveedor").value,
        producto: document.getElementById("producto").value,
        cantidad: document.getElementById("cantidad").value
      };

      const res = await fetch("http://localhost:3000/api/pedidos", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(pedido)
      });

      const data = await res.json();
      document.getElementById("mensaje").textContent = data.message;

      e.target.reset();

      cargarPedidos();//refrescar tabla despues de guardar
    });

    cargarPedidos();//cargar pedidos al iniciar o refresar

    async function cargarPedidos() {
    const res = await fetch("http://localhost:3000/api/pedidos");
    const pedidos = await res.json();

    const tbody = document.querySelector("#tablaPedidos tbody");
    tbody.innerHTML = ""; // limpiar antes de volver a pintar

    pedidos.forEach(p => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
        <td>${p.proveedor}</td>
        <td>${p.producto}</td>
        <td>${p.cantidad}</td>
        `;
        tbody.appendChild(fila);
    });
    }
  </script>
</body>
</html>